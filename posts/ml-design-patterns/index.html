<!DOCTYPE html>
<html lang="en-uk">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.74.3" />

    
    
    

<title>Machine Learning Design Patterns â€¢ Machine learning in real life</title>
<meta name="google-site-verification" content="TCP3Xybh5xzOfqotpAWEcZvWXDkTewIEh8oUbcnpT3U" />
<meta name="description" content="" />
<meta itemprop="description" content="I would like to tell you a story. I was trying to understand a bug. I spent maybe 5 pomodoros on it. Pomodoro is a technique that helps you to stay focus. I couldn&#39;t find the root cause of my bug. I was quite frustrated but still motivated. I decided to stop my session of pomodoros and left my work for the day. I went to my beautiful cat and started petting her. I was starting relaxing when at a sudden I got the solution to my bug." />
<meta property="og:description" content="I would like to tell you a story. I was trying to understand a bug. I spent maybe 5 pomodoros on it. Pomodoro is a technique that helps you to stay focus. I couldn&#39;t find the root cause of my bug. I was quite frustrated but still motivated. I decided to stop my session of pomodoros and left my work for the day. I went to my beautiful cat and started petting her. I was starting relaxing when at a sudden I got the solution to my bug." />
<meta name="twitter:description" content="I would like to tell you a story. I was trying to understand a bug. I spent maybe 5 pomodoros on it. Pomodoro is a technique that helps you to stay focus. I couldn&#39;t find the root cause of my bug. I was quite frustrated but still motivated. I decided to stop my session of pomodoros and left my work for the day. I went to my beautiful cat and started petting her. I was starting relaxing when at a sudden I got the solution to my bug." />
<meta name="keywords" content="nastasia saby, nastasia, saby, engineer, data, deep learning, shallow learning, learning, machine, tests, unit, people, analytics, book, career, concepts, data science, machine learning, pomodoro, issue, failure, data drift, model drift, drift, mlops, dataops, devops, sexism, unit tests, improve, mistakes">
<meta name="application-name" content="Machine Learning Design Patterns | Machine learning in real life" />
<meta property="og:site_name" content="" />
<meta itemprop="name" content="Machine Learning Design Patterns | Machine learning in real life" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://mlinreallife.github.io/mia_cute.jpg"/>

<meta name="twitter:title" content="Machine Learning Design Patterns"/>
<meta name="twitter:description" content="I would like to tell you a story. I was trying to understand a bug. I spent maybe 5 pomodoros on it. Pomodoro is a technique that helps you to stay focus. I couldn&#39;t find the root cause of my bug. I was quite frustrated but still motivated. I decided to stop my session of pomodoros and left my work for the day. I went to my beautiful cat and started petting her. I was starting relaxing when at a sudden I got the solution to my bug."/>
<meta name="twitter:site" content="@saby_nastasia"/>

<meta property="og:title" content="Machine Learning Design Patterns" />
<meta property="og:description" content="I would like to tell you a story. I was trying to understand a bug. I spent maybe 5 pomodoros on it. Pomodoro is a technique that helps you to stay focus. I couldn&#39;t find the root cause of my bug. I was quite frustrated but still motivated. I decided to stop my session of pomodoros and left my work for the day. I went to my beautiful cat and started petting her. I was starting relaxing when at a sudden I got the solution to my bug." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mlinreallife.github.io/posts/ml-design-patterns/" />
<meta property="og:image" content="https://mlinreallife.github.io/mia_cute.jpg" />
<meta property="article:published_time" content="2021-02-23T07:01:10+02:00" />
<meta property="article:modified_time" content="2021-03-09T11:57:03+01:00" />

<base href="https://mlinreallife.github.io/posts/ml-design-patterns/">
<link rel="canonical" href="https://mlinreallife.github.io/posts/ml-design-patterns/" itemprop="url" />
<meta name="url" content="https://mlinreallife.github.io/posts/ml-design-patterns/" />
<meta name="twitter:url" content="https://mlinreallife.github.io/posts/ml-design-patterns/" />
<meta property="og:url" content="https://mlinreallife.github.io/posts/ml-design-patterns/" />
<meta property="og:locale" content="en">
<meta name="language" content="English">


<meta itemprop="image" content="https://mlinreallife.github.io" />
<meta property="og:image" content="https://mlinreallife.github.io" />

<meta property="og:updated_time" content=2021-03-09T11:57:03&#43;0100 />
Sitemap & RSS Feed Tags
<link rel="sitemap" type="application/xml" title="Sitemap" href="https://mlinreallife.github.iositemap.xml" />



    






<link rel="stylesheet" href="https://mlinreallife.github.io/scss/hyde-hyde.3081c4981fb69a2783dd36ecfdd0e6ba7a158d4cbfdd290ebce8f78ba0469fc6.css" integrity="sha256-MIHEmB&#43;2mieD3Tbs/dDmunoVjUy/3SkOvOj3i6BGn8Y=">


<link rel="stylesheet" href="https://mlinreallife.github.io/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" type="image/png" sizes="144x144" href="https://mlinreallife.github.io/favicon.ico">
    <link rel="shortcut icon" type="image/png" href="https://mlinreallife.github.io/favicon.ico">
    
    

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <h1 class="site__title">
        <a href="https://mlinreallife.github.io">Machine learning in real life</a>
      </h1>
      
      
        <div class="author-image">
          <img src="https://www.gravatar.com/avatar/f1e09bf0b41e5559ff4623401378a1f8?s=240&d=mp" class="img--circle img--headshot element--center" alt="gravatar">
        </div>
      
      <h3 class="site__description">
         Nastasia Saby 
      </h3>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Machine learning in real life</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="https://mlinreallife.github.io/posts/">
						<span>Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="https://mlinreallife.github.io/newsletter/">
						<span>Newsletter</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="https://mlinreallife.github.io/nastasia_saby/">
						<span>About Me Nastasia Saby</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/@saby_nastasia" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
</section>

      </div>
    </div>
    


  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>Machine Learning Design Patterns</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Feb 23, 2021
    
    
    
    
    
    <br/>
    <i class="fas fa-clock"></i> 6 min read
</div>


  </header>
  
  
  <div class="post">
    <p>A design pattern is a way to answer to a well known problem.
Giving a name to the problem and the solution helps to handle it.</p>
<p>There are common challenges in machine learning:</p>
<ul>
<li>data quality: data accuracy, data completeness, data consistency, timeliness</li>
<li>reproducibility: you can add seed. Problem of the repeatability with distributed training</li>
<li>data drift</li>
<li>scale</li>
<li>multiple objectives: different stakeholders, different teams</li>
</ul>
<h2 id="data-representation-design-patterns">Data Representation Design Patterns</h2>
<p>Data representation = feature engineering</p>
<p>Scaling is desirable:</p>
<ul>
<li>Gradient descent optimizers require more steps to converge as the curvature of the loss function increases.</li>
<li>Better to scale for L1 and L2 optimization</li>
<li>Better to scale for algorithms such as Kmeans that are sensible to large numbers</li>
</ul>
<p>Four forms of scaling:</p>
<ul>
<li>
<p>Min-max scaling: pb =&gt; the min and max value have to be estimated from the training dataset, and they are often outliers. The real data often gets shrunk to a very narrow range in the [-1, 1] band.</p>
</li>
<li>
<p>Clipping: use &ldquo;reasonable values instead of min and max&rdquo;. This has the effect of treating outliers as -1 or 1.</p>
</li>
<li>
<p>Z-score normalization: Addresses the problem of outliers without requiring prior knowledge of what the reasonable range is by linearly scaling the input using the mean and standard deviation.</p>
</li>
<li>
<p>Winsorizing: Use the empirical distribution in the training dataset to clip the dataset to bounds given by the 10th and 90th percentile of the data values.</p>
</li>
</ul>
<p>Don&rsquo;t throw away outliers that are valid data.</p>
<ol>
<li>Hashed Feature</li>
<li>Embeddings</li>
<li>Feature Cross X</li>
<li>Multimodal input</li>
<li>Reframing X</li>
<li>Multilabel X</li>
<li>Ensembles</li>
<li>Cascade</li>
<li>Neutral class X</li>
</ol>
<h3 id="design-pattern-1-hashed-feature">Design Pattern 1: Hashed feature</h3>
<p>It addresses 3 possible problems: incomplete vocabulary, model size due to cardinality and cold start.</p>
<p>Pb: One-hot-encoding requires knowing the vocabulary beforehand.</p>
<p>Solution: Transform into string, then do a hash, divide by the desired number of buckets.
2 or more airports then are in the same bucket.</p>
<p>Trade-Offs and alternatives: Bucket collision. It is a lossy operation.</p>
<p>Skew: the loss of accuracy is particularly acute when the distribution of the categorical input is highly skewed.</p>
<p>Aggregate feature: find other features that you aggregate to get more useful information</p>
<p>Hyperparameter tuning: treat the number of buckets as a hyperparameter that is tuned.</p>
<p>Cryptographic hash: don&rsquo;t choose a hash that is a random hash.</p>
<p>Empty hash buckets: although unlikely, there is a remote possibility that even if we choose 10 hash buckets to represent 347 airports, one of the hash buckets will be empty.
Then, it may be beneficial to also use L2 regularization so that the weights associated with an empty bucket will be driven to near-zero.</p>
<h3 id="design-pattern-2-embeddings">Design Pattern 2: Embeddings</h3>
<p>Problem: one-hot-encoding can be enormous if we have many possibilities.
One-hot-encoding treats the values as independent. They are not. A world like walk is closer to the word run than to the word book.</p>
<p>Solution: Embeddings to capture closeness relationships in the input data.</p>
<p>Autoencoders can be used for that. Word2Vec, Bert. We can store embeddings in a data warehouse.</p>
<p>Can reduced the size of the features.</p>
<h3 id="design-pattern-3-feature-cross">Design Pattern 3: Feature Cross</h3>
<p>Pb: Using only the features x_1 and x_2, it&rsquo;s not possible to find a linear boundary that separates the + and - classes. This means that to solve the pb, we have to make the model more complex, perhaps by adding more layers to the model. However, a simpler solution exists.</p>
<p>It&rsquo;s the ability of crossing two features. For instance, you can concatenate hour_of_day + day_of_week.</p>
<p>Feature cross is naturally done in trees and DNN. But you can do it yourself in a simpler model which will computes faster. You can use the function &ldquo;crossed_column&rdquo; from TensorFlow or do it yourself with a concatenation.</p>
<p>Handling numerical features: transform them into categorical features with buckets.</p>
<p>Handling high cardinality: can increase the cardinality. To avoid that, use an embedding layer.</p>
<h3 id="design-pattern-4-multimodal-input">Design Pattern 4: Multimodal Input</h3>
<p>This is the ability to add different inputs: images and tabular text, numerical features and categorical features.</p>
<p>Use hot-one-encoding for categorical features.
Flatten everything to get images and tabular text.</p>
<p>You can represent the same data in different ways. For instance for text, we can use BOW (Bag of words, absence or presence of a word in a document) + embeddings.
We get a complete description of the features.</p>
<h2 id="problem-representation-design-patterns">Problem representation design patterns</h2>
<h3 id="design-pattern-5-reframing">Design Pattern 5: Reframing</h3>
<p>From a regression to a classification. Example: instead of predicting the prefect time, we bucketize the outputs and predict bucketized outputs.
We can also do the contrary. For example with ratings.</p>
<p>The more a distribution is wide spread, the more it is accuracte as a classification.
The more a distribution is tiny, the more it is accuracte as a regression.</p>
<h3 id="design-pattern-6-multilabel">Design Pattern 6: Multilabel</h3>
<p>Where we can assign more than one label to a given dataset.</p>
<p>Solution: Use &ldquo;sigmoid&rdquo; activation function in our final output layer. Instead of softmax.
The difference is that the softmax array is guaranteed to contain three values that sum to 1, whereas the sigmoid output will contain three values, each between 0 and 1.</p>
<p>Use binary_cross_entropy as loss function even for multilabel models. 3 classes is essentially 3 smaller binary classification problems.</p>
<p>To get the good values, we use a threshold.</p>
<p>Another alternative is one versus rest.</p>
<h3 id="design-pattern-7-ensembles">Design Pattern 7: Ensembles</h3>
<p>Improve performance and produce predictions that are better than any single model.</p>
<ul>
<li>Bagging =&gt; Example =&gt; RandomForest =&gt; high bias (underfitting)</li>
<li>Boosting =&gt; Example =&gt; XGBoost =&gt; high variance (overfitting)</li>
<li>Stacking: one model after another</li>
</ul>
<p>Alternative = dropout as bagging. Even if it&rsquo;s on the same data.</p>
<p>pbs: It decreases model interpretability.</p>
<h3 id="design-pattern-8-cascade">Design Pattern 8: Cascade</h3>
<p>We choose which model to run based on whether the activity belonged to a reseller.</p>
<ol>
<li>First predict which model to use</li>
<li>Then use the result of the first classifier to choose which model to use</li>
</ol>
<p>Pb: the first classifier can be mistaken. So you send a data to a model that it has never seen.</p>
<p>Cascade = when the output of th one model is an input to the following model or determines the selection of subsequent models.</p>
<ol>
<li>A classification model to identify the circumstance</li>
<li>1 model trained on unusal circustamces</li>
<li>A model trained on typical circumstances</li>
<li>A model to combine the output of the 2 separate models</li>
</ol>
<p>A kind of ensemble but a bit different.</p>
<p>But try to avoid cascade. It adds complexity. Instead add the discriminant as an input.</p>
<p>Because the first model will get errors, train the second with the result of the first one.
In fact, train all.</p>
<h3 id="design-pattern-9-neutral-class">Design Pattern 9: Neutral class</h3>
<p>Classification with yes, no and maybe.</p>
<p>Maybe is the neutral class.</p>
<p>Useful when human experts disagree.</p>
<p>useful to evaluate customer satisfaction because customers tend to be neutral.</p>
<p>We can reframe with neutral class from regression to classification introducing a neutral class.</p>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="https://mlinreallife.github.io/posts/no_need_for_focus/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Your cat might be better than focus</span>
    </a>
    
    
    <a href="https://mlinreallife.github.io/posts/press_review_9/" class="navigation-next">
      <span class="navigation-tittle">Issue 9: Code standardization, container orchestration, lakehouse, cats: concepts needed to productionalize machine learning models</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    


</article>


        </div>
        
    

<script defer src="https://use.fontawesome.com/releases/v5.11.2/js/all.js" integrity="sha384-b3ua1l97aVGAPEIe48b4TC60WUQbQaGi2jqAWM90y0OZXZeyaTCWtBTKtjW2GXG1" crossorigin="anonymous"></script>




    



    </body>
</html>
