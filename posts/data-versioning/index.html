<!DOCTYPE html>
<html lang="en-uk">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.74.3" />

    
    
    

<title>Different ways to do data versioning â€¢ Machine learning in real life</title>







<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://mlinreallife.github.io/data_versioning.png"/>



<meta name="twitter:title" content="Different ways to do data versioning"/>
<meta name="twitter:description" content="I have experienced two ways of doing data versioning and would like to share it with you.
It was always in a batch context to do supervised or unsupervised learning.
What is data versioning? Data versioning is about keeping snapshots of the state of your data. This way, you can see the state of the data at certain periods of time.
Why doing data versioning? There are many benefits:
  Rollbacks and replays on a specific date."/>

<meta name="twitter:site" content="@@saby_nastasia"/>


    






<link rel="stylesheet" href="https://mlinreallife.github.io/scss/hyde-hyde.3081c4981fb69a2783dd36ecfdd0e6ba7a158d4cbfdd290ebce8f78ba0469fc6.css" integrity="sha256-MIHEmB&#43;2mieD3Tbs/dDmunoVjUy/3SkOvOj3i6BGn8Y=">


<link rel="stylesheet" href="https://mlinreallife.github.io/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://mlinreallife.github.io/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="https://mlinreallife.github.io/favicon.png">
    
    

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://mlinreallife.github.io">Machine learning in real life</a>
      </span>
      
      
        <div class="author-image">
          <img src="https://www.gravatar.com/avatar/f1e09bf0b41e5559ff4623401378a1f8?s=240&d=mp" class="img--circle img--headshot element--center" alt="gravatar">
        </div>
      
      <p class="site__description">
         Nastasia Saby 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Machine learning in real life</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="https://mlinreallife.github.io/posts/">
						<span>Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="https://mlinreallife.github.io/newsletter/">
						<span>Newsletter</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="https://mlinreallife.github.io/about/">
						<span>About</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/@saby_nastasia" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
</section>

      </div>
    </div>
    


  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>Different ways to do data versioning</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Sep 15, 2020
    
    
    
    
    
    <br/>
    <i class="fas fa-clock"></i> 4 min read
</div>


  </header>
  
  
  <div class="post">
    <p>I have experienced two ways of doing data versioning and would like to share it with you.</p>
<p>It was always in a batch context to do supervised or unsupervised learning.</p>
<h2 id="what-is-data-versioning">What is data versioning?</h2>
<p>Data versioning is about keeping snapshots of the state of your data.
This way, you can see the state of the data at certain periods of time.</p>
<h2 id="why-doing-data-versioning">Why doing data versioning?</h2>
<p>There are many benefits:</p>
<ul>
<li>
<p>Rollbacks and replays on a specific date.</p>
</li>
<li>
<p>Debug. This is the most important purpose for me. You can dive into a previous state of the data and understand what happened.</p>
</li>
<li>
<p>Debug with a reproducible state. By versioning your model and your data, you get a reproducible state. It can be helpful if you want to explain one weird prediction for instance.</p>
</li>
</ul>
<h2 id="custom-data-versioning-system">Custom data versioning system</h2>
<p>You can set a custom versioning system. For instance, all your data can be partitioned by a date. Suppose you get regular updates of data each day. With HDFS, you can partition your data this way:</p>
<ul>
<li>data
<ul>
<li>year=2019
<ul>
<li>month=02
<ul>
<li>day=01</li>
<li>day=02</li>
<li>day=03</li>
<li>etc.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>In this case, your data is immutable.</p>
<p>To play or replay a specific date, you must pass it in your development as a variable to call the right partition. For instance with Spark:</p>
<pre><code>spark-submit yourjob --year=2019 --month02 --day=01
</code></pre><p>And in your code, you must call the right data:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">spark<span style="color:#f92672">.</span>read<span style="color:#f92672">.</span>parquet(<span style="color:#e6db74">&#34;path&#34;</span>)<span style="color:#f92672">.</span>filter(s<span style="color:#e6db74">&#34;year = &#39;{year}&#39; and month= &#39;{month}&#39; and day = &#39;{day}&#39;&#34;</span>)
</code></pre></div><p>The benefits of a custom versioning system are the following:</p>
<ul>
<li>Flexible. You have the control</li>
<li>Easy to rollback. You develop the versioning system. Then, you&rsquo;re ready to rollback or replay.</li>
</ul>
<p>But there are disadvantages:</p>
<ul>
<li>Heavy solution. You have many files in your data lake.</li>
<li>You have to develop, maintain and debug the solution.</li>
</ul>
<h2 id="automated-versioning-with-delta-lake">Automated versioning with Delta Lake</h2>
<p>Delta Lake was announced as a bigger innovation than Spark.</p>
<p>Maybe, it was for the <em>wow</em> effect. But it&rsquo;s true that Delta Lake is quite impressive. You put it above a data lake (HDFS, DBDS, etc) and then you get ACID transactions, updates, deletes and time travel with data versioning.</p>
<p>As explained in the <a href="https://delta.io/">website</a>:
<em>Delta Lake provides snapshots of data enabling developers to access and revert to earlier versions of data for audits, rollbacks or to reproduce experiments.</em></p>
<p>To do that, you have to deal with a <em>delta</em> format instead of a <em>parquet</em> format for instance.</p>
<p>Then, to see the different versions of your data, you can do:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">delta_table <span style="color:#f92672">=</span> DeltaTable<span style="color:#f92672">.</span>forPath(spark, path)
delta_table<span style="color:#f92672">.</span>history()<span style="color:#f92672">.</span>show()
</code></pre></div><p>Then, you get something like that:</p>
<table>
<thead>
<tr>
<th>version</th>
<th align="center">timestamp</th>
<th>userId</th>
<th>userName</th>
<th>operation</th>
<th>operationParameters</th>
<th>job</th>
<th>notebook</th>
<th>clusterId</th>
<th>readVersion</th>
<th>isolationLevel</th>
<th>isBlindAppend</th>
<th>operationMetrics</th>
</tr>
</thead>
<tbody>
<tr>
<td>5</td>
<td align="center">2019-07-29 14:07:47</td>
<td>t</td>
<td>Tom</td>
<td>DELETE</td>
<td>[predicate -&gt; [&quot;(&hellip;</td>
<td>null</td>
<td>###</td>
<td>###</td>
<td>4</td>
<td>WriteSerializable</td>
<td>false</td>
<td>[numTotalRows -&gt; &hellip;</td>
</tr>
<tr>
<td>4</td>
<td align="center">2019-07-29 14:07:41</td>
<td>t</td>
<td>Tom</td>
<td>UPDATE</td>
<td>[predicate -&gt; (id&hellip;</td>
<td>null</td>
<td>###</td>
<td>###</td>
<td>3</td>
<td>WriteSerializable</td>
<td>false</td>
<td>[numTotalRows -&gt; &hellip;</td>
</tr>
<tr>
<td>3</td>
<td align="center">2019-07-29 14:07:29</td>
<td>t</td>
<td>Tom</td>
<td>DELETE</td>
<td>[predicate -&gt; [&quot;(&hellip;</td>
<td>null</td>
<td>###</td>
<td>###</td>
<td>2</td>
<td>WriteSerializable</td>
<td>false</td>
<td>[numTotalRows -&gt; &hellip;</td>
</tr>
<tr>
<td>2</td>
<td align="center">2019-07-29 14:06:56</td>
<td>t</td>
<td>Tom</td>
<td>UPDATE</td>
<td>[predicate -&gt; (id&hellip;</td>
<td>null</td>
<td>###</td>
<td>###</td>
<td>1</td>
<td>WriteSerializable</td>
<td>false</td>
<td>[numTotalRows -&gt; &hellip;</td>
</tr>
<tr>
<td>1</td>
<td align="center">2019-07-29 14:04:31</td>
<td>t</td>
<td>Tom</td>
<td>DELETE</td>
<td>[predicate -&gt; [&quot;(&hellip;</td>
<td>null</td>
<td>###</td>
<td>###</td>
<td>0</td>
<td>WriteSerializable</td>
<td>false</td>
<td>[numTotalRows -&gt; &hellip;</td>
</tr>
<tr>
<td>0</td>
<td align="center">2019-07-29 14:01:40</td>
<td>t</td>
<td>Tom</td>
<td>WRITE</td>
<td>[mode -&gt; ErrorIfE&hellip;</td>
<td>null</td>
<td>###</td>
<td>###</td>
<td>null</td>
<td>WriteSerializable</td>
<td>true</td>
<td>[numFiles -&gt; 2, n&hellip;</td>
</tr>
</tbody>
</table>
<p>You can access older versions with the timestamp or the version number.</p>
<p><strong>Example with timestamp:</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">spark<span style="color:#f92672">.</span>read<span style="color:#f92672">.</span>format(<span style="color:#e6db74">&#34;delta&#34;</span>)<span style="color:#f92672">.</span>option(<span style="color:#e6db74">&#34;timestampAsOf&#34;</span>, timestamp)<span style="color:#f92672">.</span>load(path)
</code></pre></div><p><strong>Example with version:</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">spark<span style="color:#f92672">.</span>read<span style="color:#f92672">.</span>format(<span style="color:#e6db74">&#34;delta&#34;</span>)<span style="color:#f92672">.</span>option(<span style="color:#e6db74">&#34;versionAsOf&#34;</span>, version)<span style="color:#f92672">.</span>load(path)
</code></pre></div><p>The benefits of Delta Lake are the following:</p>
<ul>
<li>Automated. You don&rsquo;t need to think about how to version your data</li>
<li>Light</li>
<li>It looks like a code versioning</li>
</ul>
<p>Disadvantages:</p>
<ul>
<li>If you don&rsquo;t need to think about how to version your data, you always have to think of how to rollback or launch a replay</li>
<li>Delta Lake is for data, not for your model. By versioning your model, you can link a state of your model to a state of your data. But it&rsquo;s not automatic.</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>I think it is too soon for me to correctly evaluate Delta Lake.</p>
<p>What I can say is that we chose a custom versioning system when there was no other option. And now, we chose Delta Lake because we also use Databricks. We wanted to use Delta Lake performance optimisations too. Using time travel from Delta Lake comes naturally.</p>
<p>Automated solutions seem more attractive. That doesn&rsquo;t mean that you have nothing to do when it is set up. You must imagine how to do your rollbacks and replays.</p>
<p>Note that you can find other ways to make data versioning with some tools like <a href="https://dvc.org/">DVC</a>.</p>
<p>Thank you for reading.</p>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="https://mlinreallife.github.io/posts/data-scientists-crazy/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Do data scientists act crazy?</span>
    </a>
    
    
    <a href="https://mlinreallife.github.io/posts/streamlit/" class="navigation-next">
      <span class="navigation-tittle">Doing web without JavaScript, HTML nor CSS for data science</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    


</article>


        </div>
        
    

<script defer src="https://use.fontawesome.com/releases/v5.11.2/js/all.js" integrity="sha384-b3ua1l97aVGAPEIe48b4TC60WUQbQaGi2jqAWM90y0OZXZeyaTCWtBTKtjW2GXG1" crossorigin="anonymous"></script>




    



    </body>
</html>
